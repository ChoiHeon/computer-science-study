# CPU 스케줄링

컴퓨터의 CPU이나 시스템의 자원은 한정되어 있으므로 여러 프로세스의 상황을 고려하여 배정을 해야 합니다. 

<br>

## CPU 스케줄링 목적

* 공평성: 모든 자원이 공평하게 배정되어야 합니다.
* 효율성: 시스템 자윈이 유휴 시간 없이 사용되어야 합니다.
* 안정성: 우선순위를 사용하여 중요 프로세스가 먼저 작동되도록 합니다.
* 확장성: 프로세스의 숫자에 변동이 생겨도 시스템이 안정적으로 동작하도록 해야 합니다.
* 반응 시간 보장: 시스템은 적절한 시간 안에 프로세스의 오구에 반응해야 합니다.
* 무한 연기 방지: 특정 프로세스의 작업이 무한히 연기되면 안됩니다.

<br>

## 선점형 vs 비선점형 스케줄링

| 구분      | 선점형                                                       | 비선점형                                                     |
| --------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 작업 방식 | 실행 상태에 있는 작업을 중단시키고 새로운 작업을 실행할 수 있다. | 실행 상태에 있는 작업이 완료될 때 까지 다른 작업이 불가능하다. |
| 장점      | 프로세스가  CPU를 독점할 수 없어 대화영, 시분할 시스템에 적합하다. | CPU 스케줄러의 작업량이 적고 문맥 교환의 오버헤드가 적다.    |
| 단점      | 문맥 교환의 오버헤드가 많다.                                 | 기다리는 프로세스가 많아 처리율이 떨어진다.                  |
| 사용      | 시분할 방식 스케줄러에 사용된다.                             | 일괄 작업 방식 스케줄러에 사용된다.                          |

<br>

## 선점형 & 비선점형 스케줄링 알고리즘

* 비선점형 알고리즘
  * FCFS 
  * SJF
  * HRN
* 선점형
  * 라운드 로빈
  * SRT
  * 다단계 큐
  * 다단계 피드백 큐
* 둘다 가능한 알고리즘
  * 우선순위 스케줄링



## 프로세스의 우선순위

일반적으로 커널 프로세스의 우선순위가 일반 프로세스보다 높습니다. 또란 우선순위가 높은 프로세스가  CPU를 더 먼저, 오래 차지하는 경향이 있습니다.

| 우선순위 높음        | 우선순위 낮음      |
| -------------------- | ------------------ |
| 커널 프로세스        | 일반 프로세스      |
| 전면 프로세스        | 후면 프로세스      |
| 대화형 프로세스      | 일괄 처리 프로세스 |
| 입출력 집중 프로세스 | CPU 집중 프로세스  |

<br>

## 스케줄링 알고리즘 선택 기준

* 대기 시간: 프로세스가 생성된 후 실행되기 전까지 대기하는 시간
* 응답 시간: 첫 작업을 시작한 후 첫 번째 출력이 나오기까지 시간
* 실행 시간: 프로세스 작업이 시작된 후 종료되기까지 시간
* 반환 시간: 대기 시간을 포함하여 실행이 종료될 때까지의 시간

<br>

## FCFS 스케줄링

* 준비 큐에 도착한 순서대로 CPU를 할당하는 비선점형 스케줄링 알고리즘 입니다. 
* 비선점형이기 때문에 한 번 실행되면 프로세스가 끝한 후에 다음 프로세스를 실행할 수 있습니다. 
* 프로세스의 우선순위는 동일합니다.
* 현재 작업 중인 프로세스가 입출력이 많은 경우 CPU가 작업하지 않는 시간이 많아져 비효율적입니다.

<br>

## SJF 스케줄링

* 준비 큐에 있는 프로세스 중에서 실행시간이 가장 짧은 작업을 실행합니다.
* 최단 작업 우선 스케줄링입니다.
* 운영체제가 프로세스의 종료 시간을 정확하게 예측하기 어렵습니다.
* 작업 시간이 길면 작업이 뒤로 밀리는데 이러면 공평성이 떨어지게 되며 이런 현상을 아사현상이라 부릅니다.
  * 아사 현상을 완화하기 위한 방법으로 에이징이라는 방법이 있습니다.
  * 프로세스의 순서가 밀릴 수 있는 최대 횟수를 정해줍니다.

<br>

## HRN 스케줄링

* SJF 스케줄링에서 아사 현상을 해결하기 위해 만든 비선점형 스케줄링 알고리즘입니다.
* 최고 응답률 우선 스케줄링입니다.
* 프로세스의 대기 시간, CPU 사용 시간을 고려해 우선순위를 부여합니다.
  * 우선순위 = (대기시간 + CPU 사용시간) / CPU 사용시간
* 대기 시간이 긴 프로세스의 우선순위를 높입니다.
* 그럼에도 공평성이 많이 위배될 수 있습니다.

<br>

## 라운드 로빈 스케줄링

* 한 프로세스가 타임 슬라이스 동안 작업을 마치지 못할 경우 준비 큐의 맨 뒤로 이동합니다.
* 선점형 알고리즘 중에서 가장 단순하고 대표적인 알고리즘입니다.
* 효율적으로 사용하기 위해선 문맥 교환에 따른 추가 시간을 고려햐 타임 슬라이스를 정해야 합니다.
* 타임 슬라이스가 크다면  FCFS 와 차이점이 없으며, 작다면 문맥 교환의 오버헤드로 인해 많은 시간을 낭비할 수 도 있습니다.

<br>

## SRT 스케줄링

* 기본적으로 라운드 로빈 스케줄링과 유사합니다. 
* CPU를 할당 받을 프로세스를 선택할 때 남아 있는 작업 시간이 가장 적은 프로세스를 선택합니다.
* 따라서 남은 시간을 주기적으로 계산해야 하며 남은 시간이 더 적은 프로세스와 문맥 교환을 해야 하므로 시간 낭비가 발생합니다.
* 프로세스의 남은 시간을 계산하기 어렵고 아사 현상이 발생할 수 있기 때문에 사용이 지양됩니다.

<br>

## 우선순위 부여

한 번 우선순위를 부여하면 종료될 때 까지 변하지 않는 고정 우선순위 알고리즘과 일정 시간마다 우선순위가 변하는 변동 우선순위 알고리즘이 있습니다.

* 준비 큐에 있는 프로세스의 순서를 무시하고 우선순위가 높은 프로세스에 먼저 CPU를 할당합니다.
* 공평성을 위배하거나 아사 현상을 일으킬 수 있습니다.
* 프로세스의 순서를 우선순위에 따라 매번 바꿔야 하므로 오버헤드로 인한 효율성 하락이 발생합니다.

<br>

## 다단계 큐 스케줄링

* 우선순위에 따라 준비 큐를 여러 개 운용합니다.
* 프로세스의 우선순위는 고정되며(프로세스 종료될 떄까지 변하지 않음) 우선순위에 맞는 큐에 삽입합니다.
* 우선순위가 더 높은 큐가 비워져야 낮은 우선순위의 큐의 작업이 시작됩니다.

<br>

## 다단계 피드백 큐 스케줄링

* 우선순위에 따라 준비 큐를 여러 개 운용합니다.
* 큐의 우선순위가 높을수록 타임 슬라이스의 크기가 증가합니다.
* 해당 큐에서 실행된 프로세스가 타임 슬라이스내에 실행되지 못하면 바로 다음 우선순위 큐의 끝에 삽입됩니다.