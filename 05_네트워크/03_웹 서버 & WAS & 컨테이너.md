# 웹 서버 & WAS & 컨테이너

### Static Pages & Dynamic Pages

##### 1. Static Pages

* 서버(web server)에 미리 저장된 파일(image, html, javascript 등)이 그래도 전달되는 웹 페이지입니다.
* 서버는 클라이언트의 요청에 해당되는, DB에 저장된 웹 페이지를 클라이언트에게 반환합니다.
* 클라이언트는 서버에 저장된 파일이 변하지 않는한 같은 요청에 같은 웹 페이지를 받게 됩니다.

##### 2. Dynamic Pages

* 클라이언트가 요청한 인자에 맞게 동적인 컨텐츠를 반환합니다.
* 웹 서버에 의해서실행되는 프로그램을 통해서 만들어진 결과물입니다.
  * Servlet: WAS 위에서 돌아가는 JAVA 프로그램



### Web Server

* 웹 서버는 소프트웨어와 하드웨어로 구분됩니다.
  * 소프트웨어: 클라이언트로부터 HTTP요청을 받아 정적인 컨텐츠(html, css 등)을 제공하는 컴퓨터 <u>프로그램</u>
  * 하드웨어: 웹 서버가 설치되어 있는 <u>컴퓨터</u>
* HTTP를 기반으로 클라이언트에게 요청을 받고 서비스를 제공합니다.
* 요청에 따라 다음 중 하나를 수행합니다.
  1. WAS를 거치지 않고 바로 정적인 컨텐츠를 제공합니다.
  2. 동적인 컨텐츠를 제공합니다. 클라이언트의 요청을 WAS에 보내고 WAS가 처리한 결과를 클라이언트에게 전달합니다.
* ex) Nginx, Appach Server, IIS 등



### Web Container

* Servlet, JSP를 실행할 수 있는 소프트웨어입니다. 서블릿 컨테이너라고도 합니다.
* 클라이언트의 요청의 동적인 부분을 웹 서버 대신 처리해서 정적인 파일로 만들어 웹 서버에 전달합니다.
* 웹 서버에서 JSP를 요청하면 웹 컨테이너는 JSP파일을 서블릿 파일로 변환 및 컴파일한 뒤, 이것을 실행한 결과를 웹 서버에 전달합니다.



### WAS (Web Application Server)

* **WAS = Web Server + Web Container**
* DB를 조회하거나 다양한 로직 처리를 요구하는 동적인 컨텐츠를 제공하기 위한 Application Server입니다.
* 클라이언트가 보낸 HTTP 요쳥을 받아 컴퓨터나 장치 내 애플리케이션을 수행해주는 <u>미들웨어(소프트웨어 엔진)</u>입니다.
* 분산 트랜잭션, 보안, 메시징, 스레드 처리 등의 기능을 처리하는 분산 환경에서 사용됩니다.
* **동작과정**
  1. 클라이언트가 웹 서버에 HTTP 요청을 보냅니다.
  2. 웹 서버은 받은 HTTP 요청을 WAS에 보냅니다.
  3. WAS는 관련된 서블릿을 메모리에 올립니다.
  4. WAS는 web.xml을 참조하여 해당 servlet에 대한 스레드를 생성합니다. (스레드 풀을 이용)
  5. HttpServletRequest와 HttpServletResponse 객체를 생성해 서블릿에 전달합니다.
     1. 스레드는 서블릿의 service() 메서드를 호출합니다.
     2. service() 메서드는 HTTP 메서드에 따라 doGet() 또는 doPost() 메서드를 호출합니다.
  6. doGet() 또는 doPost()는 인자를 바탕으로 생성한 동적 컨텐츠를 HttpServletResponse 객체에 담아 WAS에 전달합니다.
  7. WAS는 받은 HttpServletResponse 객체를 HttpResponse 객체로 변환해서 웹 서버에 전달합니다.
  8. 생성한 스레드를 종료하고 객체들을 소멸시킵니다.



### WAS가 필요한 이유

* 웹 서버만 있다면 사용자가 요청하는 결과 값을 미리 모두 준비해야 합니다. 
* 이 경우 자원이 너무 많이 소요됩니다.
* 요청에 맞는 데이터를 DB에서 가져와 바로 결과를 만드는 것이 자원에 효율적입니다.



### Web Server가 필요한 이유

* WAS는 DB 조회 등 다양한 로직을 수행하기 때문에 단순한 정적인 컨텐츠는 웹 서버가 처리하는 것이 더 효율적입니다.

* 웹 서버에서 SSL에 대한 암호화, 복호화를 처리하게 함으로서 물리적인 분리로 인한 보안 강화를 얻을 수 있습니다.

* load balancing을 위해서 사용할 수 있습니다. (여러 대의 WAS를 연결 가능)

* 즉, <u>자원 이용의 효율성, fail over, fail back, 배포 및 유지보수의 편의성</u> 측면에서 이득을 얻을 수 있습니다.

  > 처리 과정에서 웹 서버를 WAS보다 앞에 두고 WAS를 웹 서버의 플러그인 형태로 설정하면 효율적인 분산 처리가 가능합니다.



### Web Service Architecture

* 다양한 형태가 가능합니다.
  - Client => Web Server => DB
  - Client => WAS => DB
  - Client => Web Server => WAS => DB





